<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="UTF-8" />
        <title>GobEngine</title>
        <link rel="stylesheet" href="app_assets/stylesheets/workspace/editor_viewport/viewport_styles.css" dir="auto" />
        <link rel="stylesheet" href="app_assets/stylesheets/workspace/editor_windows/editor_frames.css" dir="auto" />
        <link rel="stylesheet" href="app_assets/stylesheets/workspace/editor_tabs/tab_styles.css" dir="auto" />
        <link rel="stylesheet" href="app_assets/stylesheets/toolbar.css" dir="auto" />
    </head>
    <style>
        body {
            margin: 0 !important;
            font-family: Arial, Helvetica, sans-serif !important;
            overflow: hidden !important;
            background: lightseagreen;
        }
    </style>
    <body>
        <div class="application-toolbar" id="ApplicationToolbarManager">
            <div class="toolbar-wrapper" id="ToolbarWrapper">
                <!-- Left -->
                <div class="toolbar-section" id="ToolbarSectionLeft">
                    <button class="toolbar-selection app" id="GobEngineSelections"><img src="app_assets/images/icons/favicon_main.svg"></button>
                    <button class="toolbar-selection" id="FileSelections">File</button>
                    <button class="toolbar-selection" id="EditSelections">Edit</button>
                    <button class="toolbar-selection" id="ViewSelections">View</button>
                </div>
                <!-- Right -->
                <div class="toolbar-section" id="ToolbarSectionRight">

                </div>
            </div>
            <!-- Selection Options Menus -->
            <div class="selections-menu-row">
                <!-- GobEngine Selection Options -->
                <div class="toolbar-selections-menu" id="ApplicationSelectionMenu" name="GobEngine">
                    <button class="toolbar-selection-menu-option"></button>
                </div>
                <!-- File Selection Options -->
                <div class="toolbar-selections-menu" id="FileSelectionsMenu" name="File">
                    <button class="toolbar-selection-menu-option" id="NewFileOption">New Project</button>
                    <button class="toolbar-selection-menu-option" id="OpenFileOption">Open Project</button>
                    <button class="toolbar-selection-menu-option" id="SaveFileOption">Save Project</button>
                    <button class="toolbar-selection-menu-option" id="SaveAsFileOption">Save Project As</button>
                </div>
            </div>
        </div>
        <div id="RenderingArea" style="width: 100%; height: calc(100vw - 30px);">
            <div class="taskbar-current-tabs">
                <ol>
                    <button class="workspace-editor-tab"></button>
                </ol>
            </div>
            <div class="inline-editor-frame">
                <!-- Inline frame left -->
                <div class="inline-frame left">
                    <span>
                        <h4 class="header explorer">Explorer</h4>
                    </span>
                </div>

                <!-- Rendering Canvas --><canvas id="RenderingCanvas" virtualkeyboardpolicy="false"></canvas>

                <!-- Inline frame right -->
                <div class="inline-frame right">
                    <span>
                        <h4 class="header properties">Properties</h4>
                    </span>
                </div>
            </div>
            <div class="bottom-editor-frame">
                <section>

                </section>
            </div>
        </div>
    </body>
    <!-- JavaScript - Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" async src="app_assets/scripts/toolbar_system.js"></script>
    <script>
        const socket = io("http://localhost:72"); // connect to the app backend
        // Toolbar Selection Buttons
        const GobEngineSelectionsButton = document.querySelector("#ToolbarSectionLeft .toolbar-selection:nth-child(1)");
        const FileButton = document.querySelector("#ToolbarSectionLeft .toolbar-selection:nth-child(2)");
        const EditButton = document.querySelector("#ToolbarSectionLeft .toolbar-selection:nth-child(3)");
        const ViewButton = document.querySelector("#ToolbarSectionLeft .toolbar-selection:nth-child(4)");
        /**
         * @param {HTMLButtonElement} element
         * @param {boolean} bool
        */
        async function linkOpenSelectionFunction(element, bool) {
            if (!element || bool === null || !(element instanceof HTMLElement)) return;
            if (window.openSelectionMenu !== null) {
                window.openSelectionMenu(element, bool);
            }
        }
        window.addEventListener("DOMContentLoaded", () => {
            [GobEngineSelectionsButton, FileButton, EditButton, ViewButton].forEach((button) => {
                const ButtonID = button.getAttribute("id");
                button.setAttribute("hovered", "false");
                button.setAttribute("toggled", "false");
                // 
                button.addEventListener("mouseenter", () => {
                    button.setAttribute("hovered", "true");
                }, { passive: true });
                // 
                button.addEventListener("mouseleave", () => {
                    button.setAttribute("hovered", "false");
                }, { passive: true });
                // 
                button.addEventListener("click", (e) => {
                    e.stopPropagation();
                    if (button.getAttribute("toggled") === "false") {
                        linkOpenSelectionFunction(button, true);
                        button.setAttribute("toggled", "true");
                    } else if (button.getAttribute("toggled") === "true") {
                        linkOpenSelectionFunction(button, false);
                        button.setAttribute("toggled", "false");
                    }
                }, { passive: true });
                // 
                document.addEventListener("click", (e) => {
                    e.stopPropagation();
                    if (button.getAttribute("hovered") === "true" && button.getAttribute("toggled") === "true") return;
                    button.setAttribute("toggled", "false");
                    linkOpenSelectionFunction(button, false);
                }, { passive: true });
            });
        }, { once: true, passive: true });
    </script>
</html>
