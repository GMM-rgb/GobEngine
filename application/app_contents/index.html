<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="UTF-8" />
        <title>GobEngine</title>
        <link rel="stylesheet" href="app_assets/stylesheets/toolbar.css" dir="auto" />
    </head>
    <style>
        body {
            margin: 0 !important;
            font-family: Arial, Helvetica, sans-serif !important;
            overflow: hidden !important;
        }
    </style>
    <body>
        <div class="application-toolbar" id="ApplicationToolbarManager">
            <div class="toolbar-wrapper" id="ToolbarWrapper">
                <!-- Left -->
                <div class="toolbar-section" id="ToolbarSectionLeft">
                    <button class="toolbar-selection app" id="GobEngineSelections"><img src="app_assets/images/icons/favicon_main.svg"></button>
                    <button class="toolbar-selection" id="FileSelections">File</button>
                    <button class="toolbar-selection" id="EditSelections">Edit</button>
                    <button class="toolbar-selection" id="ViewSelections">View</button>
                </div>
                <!-- Right -->
                <div class="toolbar-section" id="ToolbarSectionRight">

                </div>
                <!-- Selection Options Menus -->
                <!-- File Selection Options -->
                <div class="toolbar-selections-menu" id="FileSelectionsMenu" name="File">
                    <button class="toolbar-selection-menu-option" id="NewFileOption">New File</button>
                    <button class="toolbar-selection-menu-option" id="OpenFileOption">Open File</button>
                    <button class="toolbar-selection-menu-option" id="SaveFileOption">Save File</button>
                    <button class="toolbar-selection-menu-option" id="SaveAsFileOption">Save As?</button>
                </div>
            </div>
        </div>
        <div id="RenderingArea" style="width: 100%; height: calc(100vh - 30px);">
            <div class="taskbar-current-tabs">

            </div>
            <!-- Rendering Canvas -->
            <canvas id="RenderingCanvas" virtualkeyboardpolicy="false" style="width: 100%; height: 100%;"></canvas>
        </div>
    </body>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="app_assets/scripts/modules/toolbar_system.js"></script>
    <script async>
        const socket = io("http://localhost:72"); // connect to the app backend
        // 
        const FileSelectionsMenu = document.getElementById("FileSelectionsMenu");
        // Toolbar Selection Buttons
        const GobEngineSelectionsButton = document.querySelector("#ToolbarSectionLeft .toolbar-selection:nth-child(1)");
        const FileButton = document.querySelector("#ToolbarSectionLeft .toolbar-selection:nth-child(2)");
        const EditButton = document.querySelector("#ToolbarSectionLeft .toolbar-selection:nth-child(3)");
        const ViewButton = document.querySelector("#ToolbarSectionLeft .toolbar-selection:nth-child(4)");
        
        /**
         * 
         * @param {HTMLButtonElement} element
         * @param {boolean} bool
        */
        async function linkOpenSelectionFunction(element, bool) {
            if (!element || !bool) return;
            if (window.openSelectionMenu !== null) {
                window.openSelectionMenu(element, bool);
            }
        }
        //
        window.addEventListener("DOMContentLoaded", () => {
            let HoveringSelectionBtns = {};
            [GobEngineSelectionsButton, FileButton, EditButton, ViewButton].forEach(button => {
                const ButtonID = button.getAttribute("id");
                HoveringSelectionBtns[ButtonID];
                // 
                button.addEventListener("mouseenter", () => {
                    HoveringSelectionBtns.ButtonID = true;
                }, { passive: true });
                // 
                button.addEventListener("mouseleave", () => {
                    HoveringSelectionBtns.ButtonID = false;
                }, { passive: true });
                // 
                button.addEventListener("click", () => {
                    if (button.getAttribute("toggled") === "true") {
                        button.setAttribute("toggled", "false");
                        linkOpenSelectionFunction(button, false);
                    } else {
                        button.setAttribute("toggled", "true");
                        linkOpenSelectionFunction(button, true);
                    }
                }, { passive: true });
                // 
                document.addEventListener("click", (e) => {
                    e.stopPropagation();
                    if (HoveringSelectionBtns.ButtonID === true) return;
                    button.setAttribute("toggled", "false");
                    // window.openSelectionMenu(button, false);
                    linkOpenSelectionFunction(button, false);
                }, { passive: true });
            });
        }, { once: true, passive: true });
    </script>
</html>
